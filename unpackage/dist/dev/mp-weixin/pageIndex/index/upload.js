"use strict";var y=Object.defineProperty,b=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var m=(e,o,a)=>o in e?y(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,w=(e,o)=>{for(var a in o||(o={}))L.call(o,a)&&m(e,a,o[a]);if(p)for(var a of p(o))T.call(o,a)&&m(e,a,o[a]);return e},d=(e,o)=>b(e,x(o));var t=require("../../common/vendor.js"),f=require("../../utils/index.js"),g=require("../../utils/api.js"),v=require("../../utils/ali-oss.js");require("../../utils/http.js");require("../../utils/index1.js");require("../../utils/base.js");const N={data(){return{scrollTop:0,tipShow:!1,href:"https://uniapp.dcloud.io",load_2_show:2,isShowFile:!1,isShowCollect:!1,rightBoxShow:!0,rightStyle:!1,rigthBtnShow:!1,pickUpCode:"xxxxxx",getCode:"",imgArr3:[],showWx:!0,fileListAllNum:0,addFileShow:!1,openSetList:!1,pickUpCode:"xxxxxx",fileList:[],fileListName:[],loginState:!1,openPass:0,pass:"",description:"",select_1:0,select_2:0,select_3:!1,select_4:!1,select_5:!1,select_6:!1,select_7:!1,select_8:1,select_10:0,passwordShow:!1,openPass:0,pass:"",downloadLimit:10,nubshow:!1,enableDown:1,enablePreview:1,mails:"",phones:"",dateValue:0,downLimit:[5,10,20],allSize:0,progress:{},downTime:0,alreadySize:0,alreadyNum:0,speed:"256kb",waterNum:0,upLoadEnd:!1,transferGuid:"",getCode:"",aKeyCopayShow:!0,overTime:"xxxx-xx-xx",extractCode:"",qrCode:"",isShow:!1,top:0,errFileList:[],resetUploadShow:!1,resetUploadTimes:0,wxDailogShow:!1,shareShow:!1,startX:0,startY:0,downNumber:10,downNumbershow:"10\u6B21",downDay:1,downDayshow:"1\u5929",utilsType:!1,drawer:!1,show:!1,timeshow:!1,actions:[{name:"1\u5929",value:"1"},{name:"3\u5929",value:"3"},{name:"7\u5929",value:"7"},{name:"\u6C38\u4E45\u6709\u6548",value:"3650"},{name:"\u81EA\u5B9A\u4E49",value:"0"}],nubactions:[{name:"50\u6B21",value:"50"},{name:"100\u6B21",value:"100"},{name:"200\u6B21",value:"200"},{name:"\u65E0\u9650\u5236",value:"9999999"},{name:"\u81EA\u5B9A\u4E49",value:"0"}]}},onLoad(e){console.log(JSON.parse(e.list)),console.log(6969),this.$nextTick(()=>{})},methods:d(w(w({},t.mapMutations(["SET_FILELIST"])),t.mapActions(["REQUEST_FLOW"])),{byTes(e){return f.bytesToSize(e)},switchChange(e){if(e.detail.value==!0?this.select_1=1:this.select_1=0,console.log(this.select_1),!t.index.getStorageSync("token")&&e.detail.value==!0){this.select_1=0,console.log(this.select_1);return}},setPswChange(e){e.detail.value==!0?(this.select_2=1,console.log(this.show)):this.select_2=0,console.log(this.select_2)},setYlChange(e){e.detail.value==!0?this.select_8=1:this.select_8=0,console.log(this.select_8)},setXzChange(e){e.detail.value==!0?this.select_10=1:this.select_10=0},overlay(e){e==1?(this.nubshow=!0,setTimeout(()=>{this.nubshow=!1},100)):(this.timeshow=!0,setTimeout(()=>{this.timeshow=!1},100))},fileFunc(e){console.log(e),console.log(6666666666666);let o=e.tempFiles;if(console.log(o),console.log(899999),!t.index.getStorageSync("token")&&o.length>5){t.index.showToast({icon:"none",title:"\u672A\u767B\u5F55\u72B6\u6001\u4E0A\u4F20\u4E0D\u5F97\u8D85\u8FC75\u4E2A"});return}let n=[];o.forEach(l=>{let s=f.getSuffix(l.name);f.isImage(s)?l.thisType="image":f.isVideo(s)?l.thisType="video":l.thisType="file",n.push(l)}),console.log(o),console.log(n),console.log(this.fileListName),console.log(n),this.fileListName=[...new Set(this.fileListName)];for(let l=0;l<n.length;l++)for(let s=0;s<this.fileListName.length;s++)n[l].name==this.fileListName[s]&&(t.index.showToast({icon:"none",title:"\u53D1\u73B0\u6587\u4EF6\u540D\u79F0\u76F8\u540C\u7684\u6587\u4EF6\uFF0C\u8BE5\u6587\u4EF6\u5DF2\u88AB\u81EA\u52A8\u8FC7\u6EE4"}),this.fileListName.splice(s,1),n.splice(l,1));console.log(this.fileListName),console.log(n),this.fileList=this.fileList.concat(n),this.fileList.forEach(l=>this.fileListName.push(l.name)),this.fileList=this.uniqueFunc(this.fileList,"name"),this.fileListAllNum=this.fileList.length,this.load_2_show=2;let i=0;this.$nextTick(()=>{this.scrollTop=this.fileList.length*64}),n.forEach(l=>{i+=l.size}),this.allSize+=i,this.SET_FILELIST(this.fileList),this.addFileShow=!1,this.transferType=1},uniqueFunc(e,o){const a=new Map;return e.filter(n=>!a.has(n[o])&&a.set(n[o],1))},async uploadFunc(){this.load_2_show=3;const e=await this.getTransferGuid();this.overTime=e.data.validDate,this.transferGuid=e.data.transferGuid,this.copyUrl=urlOSS+e.data.link;const a=(await g.getOssToken()).data;this.multipartUpload(a)},async multipartUpload(e){let o=[];this.fileList.forEach(s=>{if(s.dir){let r=v.getFileNameUUID();s.files.forEach(h=>{let u=h.webkitRelativePath.substring(h.webkitRelativePath.indexOf("/"));u||(u=h.name.substring(h.name.indexOf("/")));let c={};c.name=r+u,c.file=h,o.push(c)})}else{let r=v.getFileNameUUID()+"/"+s.name,h={};h.name=r,h.file=s,o.push(h)}});let a=setInterval(()=>{this.downTime+=1},1e3);const n=this.transferGuid;this.upLoadEnd=!1;let i=[];if((await Promise.all(o.map(async(s,r)=>{let h={fileName:s.file.name,fileSize:s.file.size,path:s.name,originalName:s.file.webkitRelativePath?s.file.webkitRelativePath:s.file.name,transferGuid:n,fileType:s.file.type};return i.push(h),await this.multiBackPath(e,s.name,s.file)}))).some(s=>s==!1)){this.resetUploadShow=!0;return}else{let s;this.select_1==!0?s=1:s=0;let r=0;if(i.forEach(S=>{r+=S.fileSize}),(await uploadBefore({filesList:i,saveEverBox:s,totalFileSize:r})).data.code!==0){this.$message.error(this.$t("la.uploadFailedUA"));return}this.$refs.water.isShow=!1;let u={};u.transferGuid=n,u.saveEverBox=s,u.transferType=1;const _=(await completUpload(u)).data.data;this.pickUpCode=_,createZip(n),await sendEmailAndSMS(n),clearInterval(a)}this.upLoadEnd=!0,this.downTime=0},async getTransferGuid(){let e={};if(this.select_2?e.openPass=1:e.openPass=0,this.select_4&&!f.isEmall(this.mails)){t.index.showToast({icon:"none",title:"\u90AE\u4EF6\u683C\u5F0F\u9519\u8BEF"});return}if(this.select_2&&(this.pass.length>12||this.pass.length<6)){t.index.showToast({icon:"none",title:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u5BC6\u7801\u683C\u5F0F"});return}e.transferType=1,e.pass=this.pass,e.mails=[],this.mails?e.mails.push(this.mails):delete e.mails,e.userId=t.index.getStorageSync("loginUserId"),e.description=this.description,e.downDay=this.downDay,e.downloadLimit=this.downNumber,e.enableDown=this.select_7?1:0,e.enablePreview=this.select_8,console.log(e),this.loginState?e.shareFlow=this.select_10:e.shareFlow=0;for(let a in e)!e[a]&&e[a]!==0&&delete e[a];return(await g.createTransfer(e)).data},onselect(e){console.log(e),this.show=!1,e.target.value==1?(this.downDay="1",this.downDayshow="1\u5929",this.timeshow=!1):e.target.value==3?(this.downDay="3",this.downDayshow="3\u5929",this.timeshow=!1):e.target.value==7?(this.downDay="7",this.downDayshow="7\u5929",this.timeshow=!1):e.target.value==3650?(this.downDay="3650",this.downDayshow="\u6C38\u4E45\u6709\u6548",this.timeshow=!1):e.target.value==0&&(this.downDayshow="",this.select_3=!0,this.timeshow=!1)},nubselect(e){console.log(e),this.show=!1,e.target.value==50?(console.log(e.target.value),this.downNumber=50,this.downNumbershow="50\u6B21",this.nubshow=!1):e.target.value==100?(this.downNumber=100,this.downNumbershow="100\u6B21",this.nubshow=!1):e.target.value==200?(this.downNumber=200,this.downNumbershow="200\u6B21",this.nubshow=!1):e.target.value==9999999?(this.downNumber=9999999,this.downNumbershow="\u65E0\u9650\u5236",this.nubshow=!1):e.target.value==0&&(this.downNumbershow="",this.select_6=!0,this.nubshow=!1)},qhdnbm(){this.select_6=!1,this.nubshow=!0,this.downNumber=10,this.downNumbershow="10\u6B21"},qhdwd(){this.select_3=!1,this.timeshow=!0,this.downDay="1",this.downDayshow="1\u5929"},savePan(e){if(this.select_1=e,this.select_1===1){this.select_1=0;return}},deleteItem(e,o){this.fileListName=[...new Set(this.fileListName)],console.log(this.fileListName);for(let n=0;n<this.fileListName.length;n++)e.name==this.fileListName[n]&&this.fileListName.splice(n,1);this.allSize-=this.fileList[o].size;let a=this.fileList.splice(o,1);a[0].files?this.fileListAllNum-=a[0].files.length:this.fileListAllNum-=1,this.$refs.fileInput2&&(this.$refs.fileInput2.value=null),this.$refs.dirInput2&&(this.$refs.dirInput2.value=null),this.fileList.length==0&&(this.load_2_show=1,this.fileListName=[],this.fileListAllNum=0,this.allSize=0)}}),computed:d(w({},t.mapState({userFlowData:e=>t.index.getStorageSync("userFlowData")?JSON.parse(e.userFlowData):{}})),{aKeyCopay(){let e=this.copyUrl,o=this.pickUpCode,a;return this.fileList.length>0&&(a=this.fileList[0].name),o=="xxxxxx"?"\u60A8\u6709\u4E00\u4EFD\u6587\u4EF6\u3010"+a+"\u3011\u5F85\u67E5\u6536\uFF01\u5373\u523B\u70B9\u51FB\u94FE\u63A5\u83B7\u53D6\uFF1A"+e:"\u60A8\u6709\u4E00\u4EFD\u6587\u4EF6\u3010"+a+"\u3011\u5F85\u67E5\u6536\uFF01\u5373\u523B\u70B9\u51FB\u94FE\u63A5\u83B7\u53D6\uFF1A"+e+this.$t("la.pickUupCode")+o+" ( \u6709\u6548\u671F\u81F3 :"+this.overTime+" )"},copyPickUpCode(){return this.pickUpCode},getHeight(){let e=0;return this.load_2_show==1?e="70px":this.load_2_show==4?e="355px":e="88vh",e}}),mounted(){console.log(this.userFlowData),console.log("this.userFlowData")}};if(!Array){const e=t.resolveComponent("uni-file-picker"),o=t.resolveComponent("van-action-sheet"),a=t.resolveComponent("van-divider"),n=t.resolveComponent("van-popup");(e+o+a+n)()}const k=()=>"../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js";Math||k();function C(e,o,a,n,i,l){return t.e({a:i.load_2_show==2},i.load_2_show==2?t.e({b:t.sr("fileInput2","30ba4ef8-0"),c:t.o(s=>l.fileFunc(s)),d:t.p({["file-mediatype"]:"all"}),e:t.t(i.fileListAllNum),f:t.t(l.byTes(i.allSize)),g:t.f(i.fileList,(s,r,h)=>t.e({a:s.thisType=="image"},s.thisType=="image"?{}:{},{b:s.thisType=="video"},s.thisType=="video"?{}:{},{c:s.thisType=="file"},s.thisType=="file"?{}:{},{d:s.thisType=="dir"},s.thisType=="dir"?{}:{},{e:t.t(s.name?s.name:"\u672A\u8BFB\u53D6\u7684"),f:s.dir},s.dir?{}:{},{g:s.dir},s.dir?{}:{},{h:s.dir},s.dir?{i:t.t(s.len)}:{},{j:t.t(l.byTes(s.size)),k:t.o(u=>l.deleteItem(s,r)),l:r})),h:i.scrollTop,i:t.o(s=>i.addFileShow=!1),j:t.o((...s)=>l.switchChange&&l.switchChange(...s)),k:!i.select_6},i.select_6?{o:i.downNumber,p:t.o(s=>i.downNumber=s.detail.value),q:t.o(s=>l.qhdnbm())}:{l:t.t(i.downNumbershow),m:t.o(s=>i.nubshow=!0),n:t.o(s=>i.nubshow=!0)},{r:t.o(s=>l.overlay(1)),s:t.o(l.nubselect),t:t.p({closeable:!0,show:i.nubshow,actions:i.nubactions,description:"\u9009\u62E9\u4E0B\u8F7D\u6B21\u6570",closeOnClickAction:!0}),v:!i.select_3},i.select_3?{z:i.downDay,A:t.o(s=>i.downDay=s.detail.value),B:t.o(s=>l.qhdwd())}:{w:t.t(i.downDayshow),x:t.o(s=>i.timeshow=!0),y:t.o(s=>i.timeshow=!0)},{C:t.o(s=>l.overlay(2)),D:t.o(l.onselect),E:t.p({closeable:!0,show:i.timeshow,actions:i.actions,description:"\u9009\u62E9\u6709\u6548\u671F",closeOnClickAction:!0}),F:i.description,G:t.o(s=>i.description=s.detail.value),H:t.n(i.loginState?"textareaBox":"textareaBoxFalse"),I:i.openSetList?1:"",J:t.o(s=>i.show=!i.show),K:t.o((...s)=>l.uploadFunc&&l.uploadFunc(...s)),L:t.o(s=>i.tipShow=!1),M:i.select_2==0},i.select_2==0?{}:{N:i.passwordShow?"text":"password",O:i.pass,P:t.o(s=>i.pass=s.detail.value)},{Q:i.select_2==1},i.select_2==1?t.e({R:i.passwordShow},i.passwordShow?{S:t.o(s=>i.passwordShow=!1)}:{T:t.o(s=>i.passwordShow=!0)}):{},{U:t.o((...s)=>l.setPswChange&&l.setPswChange(...s)),V:t.o(s=>i.tipShow=!1),W:t.o((...s)=>l.setYlChange&&l.setYlChange(...s)),X:t.o(s=>i.tipShow=!1),Y:t.o(s=>i.tipShow=!i.tipShow),Z:i.tipShow},i.tipShow?{}:{},{aa:t.o((...s)=>l.setXzChange&&l.setXzChange(...s)),ab:t.o(s=>i.tipShow=!1),ac:t.o(s=>i.tipShow=!1),ad:t.t(l.byTes(e.userFlowData.residueFlow)),ae:t.o(s=>i.tipShow=!1),af:t.o(s=>{i.show=!1,i.tipShow=!1}),ag:t.p({show:i.show,closeable:!0,closeIconPosition:"top-right",closeOnClickOverlay:!0,position:"bottom",round:!0,closeOnClickAction:!1})}):{})}var D=t._export_sfc(N,[["render",C],["__scopeId","data-v-30ba4ef8"],["__file","E:/Code/BeiJing-Digitalsee/Group-project/pageIndex/index/upload.vue"]]);wx.createPage(D);
